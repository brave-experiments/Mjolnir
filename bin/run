#!/usr/bin/env bash

function restart_containers() {
    docker-compose down
    docker-compose up -d
}

function deploy_dev() {
    cp docker-compose.override.yml.dist docker-compose.override.yml
    cp .env.dist .env
    restart_containers
    docker-compose exec cli sh
}

function run_tests() {
    cp docker-compose.override.test.yml.dist docker-compose.override.yml
    docker-compose up -d --no-deps cli-test
    sleep 2
    docker-compose exec -T cli-test make test-and-build
}

function run_tests_watch() {
    cp docker-compose.override.test.yml.dist docker-compose.override.yml
    docker-compose up --no-deps cli-test
}

if [[ "$#" -eq  "0" ]]
    then
        deploy_dev
        exit
fi

if [[ "$1" == "test" ]]
    then
        run_tests
        exit
fi

if [[ "$1" == "test-watch" ]]
    then
        run_tests_watch
        exit
fi
